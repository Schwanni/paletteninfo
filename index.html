<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <link
      rel="stylesheet"
      href="style.css"
    />
    <title>Palettenregister</title>
  </head>
  <body>
    <main>
      <div id="suchleiste">
        <input
          type="text"
          id="searchInput"
          placeholder="Bsp.: 1116"
        />
        <button id="searchButton">Suchen</button>
      </div>
      <div id="results"></div>

      <!-- Modal -->

      <div
        id="myModal"
        class="modal"
      >
        <div class="modal-content">
          <span class="close">&times;</span>

          <h2>Details</h2>

          <div id="modalDetails"></div>
        </div>
      </div>
    </main>

    <footer class="ml-3 mb-3">
      <nav class="font-bold text-blue-600 ">
        <a href="/mail.html">Fehlenden Artikel Melden</a>
      </nav>
    </footer>

    <script>
      let data = [];

      /* Lade die JSON-Daten

      fetch("data.json")
        .then((response) => response.json())

        .then((jsonData) => {
          data = jsonData; // Speichere die Daten in der Variable
        })

        .catch((error) => console.error("Fehler beim Laden der Daten:", error));

        */

      // Lade die api für die Tabelle

      fetch("api.php")
        .then((response) => response.json())
        .then((jsonData) => {
          data = jsonData; // Speichere die Daten
          console.log("Daten geladen:", data);
        })
        .catch((error) => console.error("Fehler beim Laden der Daten:", error));

      // Suchfunktion

      document.getElementById("searchButton").addEventListener("click", () => {
        const query = document
          .getElementById("searchInput")
          .value.toLowerCase();

        const results = data.filter(
          (item) =>
            item.artikelNr.toLowerCase().includes(query) ||
            item.beschreibung.toLowerCase().includes(query) ||
            item.palette.toLowerCase().includes(query)
        );

        // Prüfe Inhalt der Suchleiste

        if (searchInput.value.length < 1) {
          document.getElementById("results").innerHTML =
            "Bitte Artikelnummer eingeben";
          return;
        }

        if (query.length == 4 && results.length == 0) {
          document.getElementById("results").innerHTML =
            "Artrikel ist nicht vorhanden, bitte melden. </br> <a href='/mail.html'>Fehlenden Artikel Melden</a>";
          return;
        } else {
          const results = data.filter((item) => {
            const artikel = item.artikelNr ? item.artikelNr.toLowerCase() : "";
            const beschreibung = item.beschreibung
              ? item.beschreibung.toLowerCase()
              : "";
            const palette = item.palette ? item.palette.toLowerCase() : "";

            return (
              artikel.includes(query) ||
              beschreibung.includes(query) ||
              palette.includes(query)
            );
          });

          // Ergebnisse anzeigen

          const resultsDiv = document.getElementById("results");

          resultsDiv.innerHTML = ""; // Vorherige Ergebnisse löschen

          results.forEach((item) => {
            const div = document.createElement("div");
            div.innerHTML = `<div class="Artikelnummer">Artikelnummer: <p class="nummer">${item.artikelNr}</p></div><div class="Beschreibung"> Beschreibung: ${item.beschreibung}</div> `;
            div.style.cursor = "pointer"; // Zeige an, dass es klickbar ist
            div.addEventListener("click", () => showDetails(item)); // Klick-Event hinzufügen
            resultsDiv.appendChild(div);
          });
        }
      });

      // Funktion zum Anzeigen der Details im Modal

      function showDetails(item) {
        const modal = document.getElementById("myModal");
        const modalDetails = document.getElementById("modalDetails");
        modalDetails.innerHTML = `
            <div class="ArtikelNummer"><strong>Artikelnummer:</strong> <p class="ArtikelNummerColor">${item.artikelNr}</p></div>
            <p><strong>Beschreibung:</strong> ${item.beschreibung}</p>
            <p><strong>Palette:</strong> ${item.palette}</p>
            <p><strong>Kartons pro Palette:</strong> ${item.kpp}</p>
            <p><strong>Packhöhe:</strong> ${item.packhoehe}</p>
            <p><strong>Kartons pro Lage:</strong> ${item.kartonsLage}</p>
            <p><strong>Karton Art:</strong> ${item.kartonArt}</p>
          `;

        modal.style.display = "block"; // Modal anzeigen
      }

      // Schließe das Modal, wenn der Benutzer auf das "x" klickt

      document.querySelector(".close").addEventListener("click", () => {
        document.getElementById("myModal").style.display = "none";
      });

      // Schließe das Modal, wenn der Benutzer außerhalb des Modals klickt

      window.onclick = function (event) {
        const modal = document.getElementById("myModal");

        if (event.target === modal) {
          modal.style.display = "none";
        }
      };
    </script>
  </body>
</html>
